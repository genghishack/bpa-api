# NOTE: update this with your service name
service: bpa-api

# Use the serverless-webpack plugin to transpile ES6
plugins:
  - serverless-offline

# serverless-webpack configuration
# Enable auto-packing of external modules

provider:
  name: aws
  runtime: nodejs12.x
  stage: ${opt:stage}
  region: us-west-2

  # 'iamRoleStatements' defines the permission policy for the Lambda function.
  # In this case Lambda functions are granted with permissions to access DynamoDB.
  iamRoleStatements:
    - Effect: Allow
      Action:
        - lambda:InvokeFunction
      Resource: '*'

resources:
  Resources:
    BPAGatewayRestApi:
      Type: AWS::ApiGateway::RestApi
      Properties:
        Name: bpa

    BPAUserPool:
      Type: AWS::Cognito::UserPool
      Properties:
        UserPoolName: bpa-user-pool
        UsernameAttributes:
          - email
        AutoVerifiedAttributes:
          - email

  Outputs:
    UserPoolId:
      Value:
        Ref: BPAUserPool

    UserPoolArn:
      Value:
        Fn::GetAtt: [BPAUserPool, Arn]
      Export:
        Name: BPAUserPool-arn

    BPAGatewayRestApiId:
      Value:
        Ref: BPAGatewayRestApi
      Export:
        Name: BPAGateway-restApiId

    BPAGatewayRestApiRootResourceId:
      Value:
        Fn::GetAtt:
          - BPAGatewayRestApi
          - RootResourceId
      Export:
        Name: BPAGateway-rootResourceId
